{% extends 'public/index.html' %}
{% block css %}
<link href="/static/assets/theme/default/style.min.css" rel="stylesheet"/>
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="/static/assets/plugins/select2/select2.css"/>
<link rel="stylesheet" type="text/css" href="/static/assets/plugins/select2/select2-metronic.css"/>
<link rel="stylesheet" href="/static/assets/css/DT_bootstrap.css"/>
<!-- END PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="/static/assets/plugins/bootstrap-select/bootstrap-select.min.css"/>
<link rel="stylesheet" type="text/css" href="/static/assets/plugins/jquery-multi-select/css/multi-select.css"/>
<link rel="stylesheet" type="text/css" href="/static/assets/plugins/bootstrap-datepicker/css/datepicker.css" />

{% endblock %}
{% block body %}
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN EXAMPLE TABLE PORTLET-->
        <a id="back" class="btn btn-sm yellow">
             返回 <i class="fa fa-reply"></i>
        </a>
        <a id="commit" class="btn btn-sm purple">
             提交审核 <i class="fa fa-check"></i>
        </a>
        <div class="col-md-12"></div>
        <div class="portlet box grey tasks-widget">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-globe"></i>绩效考评详情{{ status }}
                </div>
            </div>
            <div class="portlet-body">
                <table class="table table-striped table-bordered table-hover table-full-width"  id="datatables">
                    <thead>
                    <tr>
                        <th>目标</th>
                        <th>具体描述</th>
                        <th>权重</th>
                        <th>打分(自评)</th>
                        <th>分数(自评)</th>
                        <th>打分(上级主管)</th>
                        <th>分数(上级主管)</th>
                        <th>打分(部门负责人)</th>
                        <th>分数(部门负责人)</th>
                        <th>绩效名称</th>
                        <th>被考评人</th>
                        <th>ID</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PORTLET-->
        <div class="portlet box grey">
            <div class="portlet-title">
                <div class="caption">
                    <h5><i class="fa fa-globe"></i>自我评价</h5>
                </div>
            </div>
            <div class="portlet-body">
                <div class="form-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <textarea id="textarea1" placeholder="在此输入评价内容" rows="3" maxlength="" class="form-control" id="maxlength_textarea"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-offset-11 col-md-9">
                            <button id="button1" class="btn purple" type="submit"><i class="fa fa-check"></i>提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PORTLET-->
        <div class="portlet box grey">
            <div class="portlet-title">
                <div class="caption">
                    <h5><i class="fa fa-globe"></i>直属主管评价</h5>
                </div>
            </div>
            <div class="portlet-body">
                <div class="form-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <textarea id="textarea2" placeholder="在此输入评价内容" rows="3" maxlength="" class="form-control" id="maxlength_textarea"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-offset-11 col-md-9">
                            <button id="button2" class="btn purple" type="submit"><i class="fa fa-check"></i>提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PORTLET-->
        <div class="portlet box grey">
            <div class="portlet-title">
                <div class="caption">
                    <h5><i class="fa fa-globe"></i>部门负责人评价</h5>
                </div>
            </div>
            <div class="portlet-body">
                <div class="form-body">
                    <div class="form-group">
                        <div class="col-md-12">
                            <textarea id="textarea3" placeholder="在此输入评价内容" rows="3" maxlength="" class="form-control" id="maxlength_textarea"></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-offset-11 col-md-9">
                            <button id="button3" class="btn purple" type="submit"><i class="fa fa-check"></i>提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>
<!--/datatables-->
{% endblock %}

{% block js %}
<script type="text/javascript" src="/static/assets/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="/static/assets/plugins/data-tables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/assets/plugins/data-tables/DT_bootstrap.js"></script>

<!--<script src="/static/assets/plugins/context.js"></script>-->
<!--<script src="/static/assets/plugins/jstree/dist/jstree.min.js"></script>-->
<script src="/static/assets/plugins/holder.js"></script>
<script src="/static/assets/plugins/stilearn-base.js"></script>
<script type="text/javascript" src="/static/assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
<script type="text/javascript" src="/static/assets/plugins/jquery-multi-select/js/jquery.multi-select.js"></script>
<script src="/static/assets/plugins/select2/select2.js"></script>
<script src="/static/assets/plugins/datatables/extras/TableTools.min.js"></script>
<script src="/static/assets/scripts/custom/table-managed.js"></script>
<script type="text/javascript" src="/static/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>


<script type="text/javascript">
var oTable;
var aButtons
/* Formating function for row details */

$(document).ready(function () {
    $('#textarea1').attr('disabled',true)
    $('#button1').attr('disabled',true)
    $('#textarea2').attr('disabled',true)
    $('#button2').attr('disabled',true)
    $('#textarea3').attr('disabled',true)
    $('#button3').attr('disabled',true)

    $('#back').on('click',function(){
        history.go(-1)
    })

    aButtons = [
            {
                "sExtends": 'text',

                "sButtonText": '<font color="white">添加</font><i class="fa fa-plus"></i>',
                "sButtonClass": "btn green ",
                "fnComplete": function (nButton, oConfig, nRow) {
                    add()
                }
            },
            {
                "sExtends": 'text',

                "sButtonText": '<font color="white">编辑</font><i class="fa fa-edit"></i>',
                "sButtonClass": "btn blue ",
                "fnComplete": function (nButton, oConfig, nRow) {
                    edit()
                }
            },
            {
                "sExtends": 'text',

                "sButtonText": '<font color="white">评分</font><i class="fa fa-pencil"></i>',
                "sButtonClass": "btn purple ",
                "fnComplete": function (nButton, oConfig, nRow) {
                    grade()
                }
            },
            {
                "sExtends": 'text',

                "sButtonText": '<font color="white">删除</font><i class="fa fa-times"></i>',
                "sButtonClass": "btn red ",
                "fnComplete": function (nButton, oConfig, nRow) {
                    del()
                }
            }
        ]
    loaddata()


});

function loaddata() {
    oTable = $('#datatables').dataTable({
        "sAjaxSource": "/KPI_table_detail_data/?rand=" + Math.random(),
        "sDom": "<'row-fluid'<'span6'T><'span6'f>r><'table-scrollable't><'fluid'<'span3'l><'span4'i><'span5'p>>",
        "bServerSide": true,
        "bPaginate": true, // 是否使用分页
        "bProcessing": true, //是否显示正在处理的提示
        "bLengthChange": true, //是否启用设置每页显示记录数
        "bFilter": true, //是否使用搜索
        "bStateSave": false,
        "bDestroy": true,
        "bSort": true, //是否使用排序
        "bAutoWidth": true, //列的宽度会根据table的宽度自适应
        "sPaginationType": "bootstrap",
//        "aLengthMenu": [
//                    [5, 15, 20, -1],
//                    [5, 15, 20, "All"] // change per page values here
//                ],
        "oTableTools": {
            "sRowSelect": "single",
            'aButtons': aButtons
        },
        "aoColumns": [
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "10%"},
            { "sClass": "center", 'sWidth': "5%", 'bVisible': false},
            { "sClass": "center", 'sWidth': "5%", 'bVisible': false},
            { "sClass": "center", 'sWidth': "5%", 'bVisible': false}


        ],
        "aaSorting": [
            [0, 'desc']
        ],
        "oLanguage": {
            "sProcessing": "正在加载数据...",
            'sSearch': '数据筛选:',
            "sLengthMenu": "每页显示 _MENU_ 项记录",
            "sZeroRecords": "没有符合项件的数据...",
            "sInfo": "当前数据为从第 _START_ 到第 _END_ 项数据；总共有 _TOTAL_ 项记录",
            "sInfoEmpty": "显示 0 至 0 共 0 项",
            "sInfoFiltered": "(_MAX_)",
            "oPaginate": {
                "sFirst": '首页',
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }

        },
        "fnInitComplete": function (oSettings, json) {
            $('input[type=checkbox],input[type=radio],input[type=file]').uniform()
        },
        "fnDrawCallback": function (oSettings) {
            $('input[type=checkbox],input[type=radio],input[type=file]').uniform()
        },
        "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
            $('td:eq(2)',nRow).html(aData[2]+'%')
        },
        "fnServerData": function (sSource, aoData, fnCallback) {
            aoData.push({csrfmiddlewaretoken: '{{ csrf_token }}'})
            $.ajax({
                "dataType": 'json',
                "type": "POST",
                "url": sSource,
                "data": aoData,
                "success": fnCallback
            });
        }
    });
}

function detail() {
    var oTT = TableTools.fnGetInstance('datatables');
    var aData = oTT.fnGetSelectedData();
    if (aData.length == 1) {
        var KPI_name = aData[0][0]
        var name = aData[0][4]
        $.post('/KPI_set_session/', {KPI_name:KPI_name,name:name}, function (d) {
            $('#refresh').load('/vacation_apply_sub/')
        })
    }
}


</script>
{% endblock %}